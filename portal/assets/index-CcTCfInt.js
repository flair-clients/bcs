import{j as E,B as re}from"./mui-Cw0dwOiN.js";import{r as y}from"./reactVendor-BTcQ-GDs.js";import{u as le}from"./form-hNmOEDBo.js";import{u as ne}from"./lang-cE5BfbQy.js";import{t as S}from"./lodashEs-Bacu-Uoa.js";import{B as M,ac as O,j as ie,C as te,a as fe,ad as de,a8 as v,ae as me,k as R,u as N,t as ue,af as ce,ag as T,X as pe,ah as Fe}from"./react-setup-B6u61idX.js";import{B as be}from"./B3CustomForm-BiO7GKz5.js";import"./load-functions-AabybIo1.js";import"./base-DriPzto9.js";import{c as he,a as we}from"./users-Ddecr0Hl.js";import{d,g as ye}from"./config-CWZnT41X.js";import{v as ge}from"./validatorRules-2gQp7SVo.js";import{u as xe}from"./router-DEI8QtBD.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.CgUuH24B.js";import"./global-D7Yn0gGb.js";import"./muiIcon-BiFRwRtm.js";import"./dateFns-CeqDayOU.js";import"./dropzone-Cizh2goU.js";const Ne=e=>"mutation{\n  updateAccountSettings (\n    updateData: ".concat(O(e),"\n  ){\n    result {\n      email\n    },\n  }\n}"),Be=e=>"mutation{\n  updateCustomerAccountSettings (\n    updateData: ".concat(O(e),"\n  ){\n    result {\n      email\n    },\n  }\n}"),Ce=e=>"{\n  accountSettings (\n    companyId: ".concat(e.companyId,"\n  ){\n    firstName,\n    lastName,\n    company,\n    phoneNumber,\n    email,\n    formFields {\n      name,\n      value\n    },\n    extraFields {\n      fieldName,\n      fieldValue,\n    }\n    role,\n    companyRoleId,\n    companyRoleName,\n  }\n}"),Ie=()=>"{\n  customerAccountSettings {\n    firstName,\n    lastName,\n    company,\n    phoneNumber,\n    email,\n    formFields {\n      name,\n      value\n    },\n  }\n}",_e=e=>M.graphqlB2B({query:Ne(e)}),Ee=e=>M.graphqlB2B({query:Be(e)}),ve=e=>M.graphqlB2B({query:Ce(e)}),Me=()=>M.graphqlB2B({query:Ie()}),Ae=()=>[{name:"company",fieldId:"field_company",label:"Company",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small"},{name:"role",fieldId:"field_role",label:"Role",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small"}],Pe=()=>[{name:"currentPassword",fieldId:"field_current_password",label:"Current Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"},{name:"password",fieldId:"field_password",label:"Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"},{name:"confirmPassword",fieldId:"field_confirm_password",label:"Confirm Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"}],D=ge(["email"]),qe=(e,o,u,n)=>{const l=(e==null?void 0:e.extraFields)||[];return o.forEach(s=>{const a=s;d((s==null?void 0:s.name)||"")==="first_name"&&(a.default=e.firstName),d((s==null?void 0:s.name)||"")==="last_name"&&(a.default=e.lastName),d((s==null?void 0:s.name)||"")==="phone"&&(a.default=e.phoneNumber),d((s==null?void 0:s.name)||"")==="email"&&(a.default=e.email,a.validate=D)}),l.length>0&&l.forEach(s=>{const a=s,f=o.find(r=>d((r==null?void 0:r.name)||"")===a.fieldName);f&&(f.default=a.fieldValue)}),u.forEach(s=>{const a=s;s.name==="role"?(a.default=e.companyRoleName,a.disabled=!0):s.name==="company"&&(a.default=e.company,a.disabled=!0)}),n.forEach(s=>{const a=((e==null?void 0:e.formFields)||[]).find(r=>r.name===s.bcLabel),f=s;a&&(f.default=a.value)}),[...o,...u,...n]},Ve=(e,o,u)=>(o.forEach(n=>{const l=n;d((n==null?void 0:n.name)||"")==="first_name"&&(l.default=e.firstName),d((n==null?void 0:n.name)||"")==="last_name"&&(l.default=e.lastName),d((n==null?void 0:n.name)||"")==="phone"&&(l.default=e.phoneNumber),d((n==null?void 0:n.name)||"")==="email"&&(l.default=e.email,l.validate=D),d((n==null?void 0:n.name)||"")==="company"&&(l.default=e.company)}),u.forEach(n=>{const l=((e==null?void 0:e.formFields)||[]).find(a=>a.name===n.bcLabel),s=n;l&&(s.default=l.value)}),[...o,...u]),Le=(e,o,u,n)=>{const l=(o==null?void 0:o.extraFields)||[],s={};s.formFields=[];let a=!0,f=!0,r=!1;if(Object.keys(e).forEach(c=>{u.forEach(i=>{if(c===i.name&&(f=!1,d(i.name)==="first_name"&&(o.firstName!==e[i.name]&&(a=!1),s.firstName=e[i.name]),d(i.name)==="last_name"&&(o.lastName!==e[i.name]&&(a=!1),s.lastName=e[i.name]),d(i.name)==="phone"&&(o.phoneNumber!==e[i.name]&&(a=!1),s.phoneNumber=e[i.name]),d(i.name)==="email"&&(o.email!==e[i.name]&&(a=!1),s.email=e[i.name]),i.custom)){const t=l.find(w=>w.fieldName===d((i==null?void 0:i.name)||""));(t==null?void 0:t.fieldValue)!==e[i.name]&&(r=!0)}}),r&&(a=!1),f&&n.forEach(i=>{var t;if(i.fieldId===c&&(s!=null&&s.formFields)){const{name:w}=i;s.formFields.push({name:(i==null?void 0:i.bcLabel)||"",value:e[c]}),f=!1;const x=((o==null?void 0:o.formFields)||[]).find(B=>B.name===i.bcLabel);x&&JSON.stringify(x.value)!==JSON.stringify(e[c])&&(a=!1),!((t=o==null?void 0:o.formFields)!=null&&t.length)&&w&&e[w]&&(a=!1)}}),f&&(c==="password"?(s.newPassword=e[c],e[c]&&(a=!1)):s[c]=e[c]),f=!0}),delete s.company,delete s.role,!a)return s},Re=(e,o,u,n)=>{const l={};l.formFields=[];let s=!0,a=!0;if(Object.keys(e).forEach(f=>{u.forEach(r=>{f===r.name&&(a=!1,d(r.name)==="first_name"&&(o.firstName!==e[r.name]&&(s=!1),l.firstName=e[r.name]),d(r.name)==="last_name"&&(o.lastName!==e[r.name]&&(s=!1),l.lastName=e[r.name]),d(r.name)==="phone"&&(o.phoneNumber!==e[r.name]&&(s=!1),l.phoneNumber=e[r.name]),d(r.name)==="email"&&(o.email!==e[r.name]&&(s=!1),l.email=e[r.name]),d(r.name)==="company"&&(o.company!==e[r.name]&&(s=!1),l.company=e[r.name]))}),a&&n.forEach(r=>{if(r.fieldId===f&&(l!=null&&l.formFields)){l.formFields.push({name:(r==null?void 0:r.bcLabel)||"",value:e[f]}),a=!1;const c=((o==null?void 0:o.formFields)||[]).find(i=>i.name===r.bcLabel);c&&JSON.stringify(c.value)!==JSON.stringify(e[f])&&(s=!1)}}),a&&(f==="password"?(l.newPassword=e[f],e[f]&&(s=!1)):l[f]=e[f]),a=!0}),!s)return l};function Te(){const e=N(ue),o=N(({company:t})=>t.companyInfo.id),u=N(({company:t})=>t.customer),n=N(({company:t})=>t.customer.role),l=N(({b2bFeatures:t})=>t.masqueradeCompany.id),s=N(({b2bFeatures:t})=>t.masqueradeCompany.isAgenting),a=Number(n===3&&s?l:o),f=!e||n===3&&!s;return{isBCUser:f,companyId:a,customer:u,validateEmailValue:async t=>{if(u.emailAddress===S(t))return!0;const w={email:t,channelId:Fe},{isValid:x}=f?await he(w):await we(w);return x},emailValidation:t=>!(t.email!==u.emailAddress&&!t.currentPassword),passwordValidation:t=>t.password===t.confirmPassword}}function ls(){const{isBCUser:e,companyId:o,customer:u,validateEmailValue:n,emailValidation:l,passwordValidation:s}=Te(),{control:a,handleSubmit:f,getValues:r,formState:{errors:c},setValue:i,setError:t}=le({mode:"onSubmit"}),[w,x]=ie("sf-isFinishUpdate",!1,sessionStorage),{state:{portalStyle:{backgroundColor:B="#FEF9F5"}}}=y.useContext(te),m=ne(),[A]=fe(),z=xe(),[P,J]=y.useState([]),[$,G]=y.useState([]),[H,X]=y.useState([]),[K,C]=y.useState(!1),[Q,W]=y.useState({}),[Y,Z]=y.useState(!1);y.useEffect(()=>{(async()=>{try{C(!0);const h=e?Me:ve,g=e?{}:{companyId:o},p=e?"customerAccountSettings":"accountSettings",U=await ce(e?1:2),F=ye(U.accountFormFields||[]),I=((F==null?void 0:F.contactInformation)||[]).filter(L=>L.fieldId!=="field_email_marketing_newsletter"),{additionalInformation:q=[]}=F,{[p]:V}=await h(g),ae=e?Ve(V,I,q):qe(V,I,Ae(),q),oe=Pe(),j=[...ae,...oe],_=j.find(L=>L.name==="role");_!=null&&_.fieldType&&(_.fieldType="text"),J(j),W(V),G(I),X(q)}finally{w&&(T.success(m("accountSettings.notification.detailsUpdated")),x(!1)),C(!1),Z(!0)}})()},[]);const k=(b,h)=>h.filter(p=>p.custom&&p.groupId===1).map(p=>({fieldName:d((p==null?void 0:p.name)||""),fieldValue:b[p.name]})),ee=()=>{f(async b=>{C(!0);try{const h=await n(b.email);h||t("email",{type:"custom",message:m("accountSettings.notification.emailExists")});const g=l(b);g||T.error(m("accountSettings.notification.updateEmailPassword"));const p=s(b);if(p||(t("confirmPassword",{type:"manual",message:m("global.registerComplete.passwordMatchPrompt")}),t("password",{type:"manual",message:m("global.registerComplete.passwordMatchPrompt")})),h&&g&&p){const F=(e?Re:Le)(b,Q,$,H);if(F&&(e||(F.companyId=o,F.extraFields=k(b,P)),F.newPassword===""&&F.confirmPassword===""&&(delete F.newPassword,delete F.confirmPassword)),!F){T.success(m("accountSettings.notification.noEdits"));return}await(e?Ee:_e)(F),b.password&&b.currentPassword||u.emailAddress!==S(b.email)?z("/login?loginFlag=loggedOutLogin"):(pe.clear(),x(!0),window.location.reload())}}finally{C(!1)}})()},se=y.useMemo(()=>{const b={field_first_name:m("accountSettings.form.firstName"),field_last_name:m("accountSettings.form.lastName"),field_email:m("accountSettings.form.email"),field_phone_number:m("accountSettings.form.phoneNumber"),field_company:m("accountSettings.form.company"),field_role:m("accountSettings.form.role"),field_current_password:m("accountSettings.form.currentPassword"),field_password:m("accountSettings.form.password"),field_confirm_password:m("accountSettings.form.confirmPassword")};return P.map(h=>{var g,p;return{...h,label:(p=b[(g=h.fieldId)!=null?g:""])!=null?p:h.label}})},[P,m]);return E.jsx(de,{isSpinning:K,background:B,children:E.jsxs(re,{sx:{width:A?"100%":"35%",minHeight:A?"800px":"300px","& input, & .MuiFormControl-root .MuiTextField-root, & .MuiSelect-select.MuiSelect-filled, & .MuiTextField-root .MuiInputBase-multiline":{bgcolor:v("#FFFFFF",.87),borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"},"& .MuiButtonBase-root.MuiCheckbox-root:not(.Mui-checked), & .MuiRadio-root:not(.Mui-checked)":{color:v(R(B),.6)},"& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label, & .MuiFormControl-root .MuiFormLabel-root:not(.Mui-focused)":{color:v(R(B),.87)},"& .MuiInputLabel-root.MuiInputLabel-formControl:not(.Mui-focused)":{color:v(R("#FFFFFF"),.6)}},children:[E.jsx(be,{formFields:se,errors:c,control:a,getValues:r,setValue:i}),E.jsx(me,{sx:{mt:"28px",mb:A?"20px":"0",width:"100%",visibility:Y?"visible":"hidden"},onClick:ee,variant:"contained",children:m("accountSettings.button.saveUpdates")})]})})}export{ls as default};
//# sourceMappingURL=index-CcTCfInt.js.map

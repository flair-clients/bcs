System.register(["./mui-legacy-nJi-LPwx.js","./reactVendor-legacy-CtYIj4Ma.js","./form-legacy-CAo5v63e.js","./lang-legacy-BZ1lZp4I.js","./react-setup-legacy-DjnQrG6U.js","./B3CustomForm-legacy-DPyFojA8.js","./load-functions-legacy-Bi-Vku98.js","./base-legacy-BAe6cWtL.js","./useBlockPendingAccountViewPrice-legacy-C0WGTZHY.js"],(function(e,t){"use strict";var s,n,i,o,r,u,a,l,c,d,p,h,g,f,k,y,m,b,x;return{setters:[e=>{s=e.j,n=e.B,i=e.G,o=e.T},e=>{r=e.r},e=>{u=e.u},e=>{a=e.u},e=>{l=e.u,c=e.t,d=e.c3,p=e.c4,h=e.ad,g=e.ae,f=e.b8,k=e.ag,y=e.aR,m=e.aS},e=>{b=e.B},null,null,e=>{x=e.u}],execute:function(){e("Q",(function(e){const t=a(),{updateList:j,quickAddToList:S,level:q=3,buttonText:A=t("shoppingList.quickAdd.addToShoppingList"),buttonLoading:v=!1,type:L}=e,I=l(c),V=l((({company:e})=>e.companyInfo.status)),$=l((({quoteInfo:e})=>e.draftQuoteList)),[w]=x(),[C,E]=r.useState(q),[P,N]=r.useState([]),[O,F]=r.useState(!1),T=(e,t)=>{new Array(e).fill(1).forEach(((e,s)=>t(s)))};r.useEffect((()=>{let e=[];T(C,(s=>{e=[...e,...f(s,t)]})),N(e)}),[C]);const{control:B,handleSubmit:Q,getValues:_,formState:{errors:z},setError:D,setValue:J}=u({mode:"all"}),R=e=>{const s={};let n=!0;return T(C,(i=>{const o=e[`sku-${i}`],r=e[`qty-${i}`];if(n=!1!==((e,s,n)=>{if(!s&&!n)return!0;let i=!0;const o=parseInt(n,10)||0;return s||(D(`sku-${e}`,{type:"manual",message:t("global.validate.required",{label:t("purchasedProducts.quickAdd.sku")})}),i=!1),n?o<=0&&(D(`qty-${e}`,{type:"manual",message:"incorrect number"}),i=!1):(D(`qty-${e}`,{type:"manual",message:t("global.validate.required",{label:t("purchasedProducts.quickAdd.qty")})}),i=!1),i})(i,o,r)&&n,n&&o){const e=parseInt(r,10)||0;s[o]=s[o]?s[o]+e:e}})),{skuValue:s,isValid:n,skus:Object.keys(s)}},U=r.useCallback(((e,t,s)=>{const n=[],i=[],o=[],r=[],u=[],a=[];return s.forEach((s=>{const l=(e||[]).find((e=>e.variantSku.toUpperCase()===s.toUpperCase()));if(!l)return void n.push(s);const{productId:c,variantId:h,option:g,purchasingDisabled:f="1",modifiers:k,variantSku:y}=l,m=d(k),b=t[s]||0;if("1"===f&&"shoppingList"!==L)return void i.push(s);if(m.filter((e=>!e.isVerified)).length>0)return void u.push(s);if(Number(b)<1||Number(b)>1e6)return void a.push(s);const x=(g||[]).reduce(((e,t)=>{try{const s="string"==typeof t?JSON.parse(t):t;return e.push({optionId:`attribute[${s.option_id}]`,optionValue:`${s.id}`}),e}catch(s){return e}}),[]);m.forEach((e=>{const{type:t}=e;if("date"===t){const{defaultValue:t}=e;Object.keys(t).forEach((t=>{x.push({optionId:`attribute[${e.option_id}][${t}]`,optionValue:`${e.defaultValue[t]}`})}))}else x.push({optionId:`attribute[${e.option_id}]`,optionValue:`${e.defaultValue}`})})),r.push(s);const j=$.find((e=>e.node.variantSku===y));if(j){const e=JSON.parse(j.node.optionList);let{quantity:t}=j.node;if((e.length>x.length?p(e,x):p(x,e))&&(t+=b),t>1e6)return void a.push(s)}o.push({...l,newSelectOptionList:x,productId:parseInt(c,10)||0,quantity:b,variantId:parseInt(h,10)||0})})),{notFoundSku:n,notPurchaseSku:i,productItems:o,passSku:r,notAddAble:u,numberLimit:a}}),[$,L]),W=(e,t,s,n)=>{t.forEach((t=>{const i=Object.keys(e).find((s=>e[s]===t))||"";i&&D(i.replace("sku",s),{type:"manual",message:n})}))},Y=()=>{w&&0===V?k.info("Your business account is pending approval. This feature is currently disabled."):Q((async e=>{try{F(!0);const{skuValue:s,isValid:n,skus:i}=R(e);if(!n||i.length<=0)return;const o=await(async e=>{const t=I?y:m;try{const{variantSku:s}=await t({skus:e},!0);return s}catch(s){return[]}})(i),{notFoundSku:r,notPurchaseSku:u,productItems:a,notAddAble:l,passSku:c,numberLimit:d}=U(o,s,i);r.length>0&&(W(e,r,"sku",""),k.error(t("shoppingList.quickAdd.skuNotFound",{notFoundSku:r.join(", ")}),{isClose:!0})),u.length>0&&(W(e,u,"sku",""),k.error(t("shoppingList.quickAdd.skuNotPurchasable",{notPurchaseSku:u.join(", ")}),{isClose:!0})),l.length>0&&(W(e,l,"sku",""),k.error(t("shoppingList.quickAdd.skuNotAddable",{notAddAble:l.join(", ")}),{isClose:!0})),d.length>0&&(d.forEach((t=>{W(e,[t],"qty","")})),k.error(t("shoppingList.quickAdd.skuLimitQuantity",{numberLimit:d.join(", ")}),{isClose:!0})),a.length>0&&(await S(a),((e,t)=>{t.forEach((t=>{const s=Object.keys(e).find((s=>e[s]===t))||"";s&&(J(s,""),J(s.replace("sku","qty"),""))}))})(e,c),j())}finally{F(!1)}}))()};return s.jsx(h,{isSpinning:O,spinningHeight:"auto",children:s.jsxs(n,{sx:{width:"100%"},children:[s.jsxs(i,{container:!0,sx:{margin:"16px 0"},children:[s.jsx(i,{item:!0,sx:{flex:1,display:"flex",alignItems:"center"},children:s.jsx(o,{sx:{color:"#000"},variant:"body1",children:t("shoppingList.quickAdd.quickAdd")})}),s.jsx(i,{item:!0,children:s.jsx(g,{variant:"text",sx:{textTransform:"initial",ml:"-8px",fontWeight:"400"},onClick:()=>{E(C+q)},children:t("shoppingList.quickAdd.showMoreRows")})})]}),s.jsx(n,{onKeyDown:e=>{"Enter"===e.key&&Y()},sx:{"& label":{zIndex:0}},children:s.jsx(b,{formFields:P,errors:z,control:B,getValues:_,setValue:J})}),s.jsx(g,{variant:"outlined",fullWidth:!0,disabled:O,onClick:Y,sx:{margin:"20px 0"},children:s.jsx(h,{isSpinning:!!v&&O,tip:"",size:16,children:s.jsx(n,{sx:{flex:1,textAlign:"center"},children:A})})})]})})}))}}}));
//# sourceMappingURL=QuickAdd-legacy-D2GhogLT.js.map

import{z as J,j as n,L as X,ae as Y,x as Z,B as L,T as I}from"./mui-Cw0dwOiN.js";import{r as f}from"./reactVendor-BTcQ-GDs.js";import{u as k}from"./lang-cE5BfbQy.js";import{B as v}from"./B3Filter-BBaOnNy3.js";import{a5 as $,bh as ee,aN as te,av as h,ax as se,a as ae,G as re,ad as oe,al as ne,u as N,t as ie,bg as le,bK as de,ah as F}from"./react-setup-B6u61idX.js";import"./load-functions-AabybIo1.js";import"./base-DriPzto9.js";import{Q as K,o as ue,p as ce}from"./QuoteStatus-BjBgc7ix.js";import{u as pe}from"./useSort-CwDaxthI.js";import{u as me}from"./router-DEI8QtBD.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./B3FilterMore-DKMT3nnn.js";import"./form-hNmOEDBo.js";import"./B3CustomForm-BiO7GKz5.js";import"./lodashEs-Bacu-Uoa.js";import"./muiIcon-BiFRwRtm.js";import"./dateFns-CeqDayOU.js";import"./B3FilterSearch-B3efZ90M.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.CgUuH24B.js";import"./global-D7Yn0gGb.js";import"./dropzone-Cizh2goU.js";const be={subtotal:0,shipping:0,tax:0,grandTotal:0},{decimal_places:ye=2}=te(),E=a=>parseFloat(a.toFixed(ye)),ge=()=>{const{draftQuoteList:a}=$.getState().quoteInfo,{showInclusiveTaxPrice:e}=$.getState().global;return a.reduce((d,i)=>{const{basePrice:u,taxPrice:r=0,quantity:o,additionalCalculatedPrices:q=[]}=i.node;let{subtotal:b,grandTotal:A,tax:s}=d;const{shipping:c}=d;let C=0,g=0;return q.forEach(y=>{C+=y.additionalCalculatedPriceTax,g+=y.additionalCalculatedPrice}),b+=E(ee(Number(u)+g,Number(r))*o),s+=E((Number(r)+C)*o),A=e?b+c:b+c+s,{grandTotal:A,shipping:c,tax:s,subtotal:b}},{...be})},xe=Z("div")({display:"flex",flexDirection:"column",alignItems:"start",marginBottom:"1rem"});function fe(a){const{item:e,goToDetail:l}=a,d=J(),i=k(),u=d.palette.primary.main,r=[{key:"quoteTitle",title:i("quotes.quoteItemCard.title")},{key:"salesRepEmail",title:i("quotes.quoteItemCard.salesRep")},{key:"createdBy",title:i("quotes.quoteItemCard.createdBy")},{key:"createdAt",title:i("quotes.quoteItemCard.dateCreated"),render:()=>"".concat(Number(e.status)!==0?h(Number(e.createdAt)):e.createdAt)},{key:"updatedAt",title:i("quotes.quoteItemCard.lastUpdate"),render:()=>"".concat(Number(e.status)!==0?h(Number(e.updatedAt)):e.updatedAt)},{key:"expiredAt",title:i("quotes.quoteItemCard.expirationDate"),render:()=>"".concat(Number(e.status)!==0?h(Number(e.expiredAt)):e.expiredAt)},{key:"totalAmount",title:i("quotes.quoteItemCard.subtotal"),render:()=>{const{totalAmount:o}=e;return se(Number(o))}}];return n.jsx(X,{children:n.jsxs(Y,{sx:{color:"rgba(0, 0, 0, 0.6)"},children:[n.jsxs(xe,{children:[n.jsx(L,{sx:{display:"flex",alignItems:"center",mb:"1rem"},children:n.jsx(I,{variant:"h6",sx:{color:"rgba(0, 0, 0, 0.87)"},children:e.quoteNumber})}),n.jsx(L,{children:n.jsx(K,{code:e.status})})]}),r.map(o=>n.jsxs(L,{sx:{display:"flex"},children:[n.jsx(I,{sx:{fontWeight:"bold",color:"rgba(0, 0, 0, 0.87)",mr:"5px",whiteSpace:"nowrap"},children:"".concat(o.title,":")}),n.jsx(I,{sx:{color:"black",wordBreak:"break-all"},children:o!=null&&o.render?o.render():e[o.key]})]},o.key)),n.jsx(L,{onClick:()=>l(e,Number(e.status)),sx:{mt:"1rem",pl:0,color:u||"#1976D2",cursor:"pointer",fontWeight:"bold",display:"inline-block"},children:i("quotes.quoteItemCard.view")})]})})}const qe=[{idLangCustomLabel:"quotes.open",statusCode:1},{idLangCustomLabel:"quotes.ordered",statusCode:4},{idLangCustomLabel:"quotes.expired",statusCode:5}],Q="quoteNumber",D={quoteNumber:"quoteNumber",quoteTitle:"quoteTitle",salesRep:"salesRep",createdBy:"createdBy",createdAt:"createdAt",updatedAt:"updatedAt",expiredAt:"expiredAt",status:"status"};function Ce(){const a=N(({company:s})=>s.companyInfo.id),e=N(({company:s})=>s.customer),l=N(ie),d=N(({quoteInfo:s})=>s.draftQuoteList.length),i=N(({b2bFeatures:s})=>s.masqueradeCompany.id),u=k(),r=a||i,o=s=>l?ue({...s,channelId:F}):ce({...s,channelId:F}),q=()=>[{name:"status",label:u("quotes.quoteStatus"),required:!1,default:"",fieldType:"dropdown",options:qe.map(({idLangCustomLabel:s,...c})=>({customLabel:u(s),...c})),replaceOptions:{label:"customLabel",value:"statusCode"},xs:12,variant:"filled",size:"small"}],b=async()=>{var g,y,x,R;const s=await de(Number(r),2),c=((y=(g=s==null?void 0:s.createdByUser)==null?void 0:g.results)==null?void 0:y.createdBy.map(p=>({createdBy:p.email?"".concat(p.name," (").concat(p.email,")"):"".concat(p.name)})))||[],C=((R=(x=s==null?void 0:s.createdByUser)==null?void 0:x.results)==null?void 0:R.salesRep.map(p=>({salesRep:"".concat(p.salesRep||p.salesRepEmail)})))||[];return[...q(),{name:"createdBy",label:u("quotes.createdBy"),required:!1,default:"",fieldType:"dropdown",options:c,replaceOptions:{label:"createdBy",value:"createdBy"},xs:12,variant:"filled",size:"small"},{name:"salesRep",label:u("quotes.salesRep"),required:!1,default:"",fieldType:"dropdown",options:C,replaceOptions:{label:"salesRep",value:"salesRep"},xs:12,variant:"filled",size:"small"}]};return{companyId:r,isB2BUser:l,draftQuoteListLength:d,customer:e,getQuotesList:o,getAvailableFilters:async()=>l?b():q()}}const Be=()=>{const a=k();return f.useMemo(()=>[{key:"quoteNumber",title:a("quotes.quoteNumber"),isSortable:!0},{key:"quoteTitle",title:a("quotes.title"),isSortable:!0},{key:"salesRep",title:a("quotes.salesRep"),render:e=>"".concat(e.salesRep||e.salesRepEmail),isSortable:!0},{key:"createdBy",title:a("quotes.createdBy"),isSortable:!0},{key:"createdAt",title:a("quotes.dateCreated"),render:e=>"".concat(Number(e.status)!==0?h(Number(e.createdAt)):e.createdAt),isSortable:!0},{key:"updatedAt",title:a("quotes.lastUpdate"),render:e=>"".concat(Number(e.status)!==0?h(Number(e.updatedAt)):e.updatedAt),isSortable:!0},{key:"expiredAt",title:a("quotes.expirationDate"),render:e=>"".concat(Number(e.status)!==0?h(Number(e.expiredAt)):e.expiredAt),isSortable:!0},{key:"totalAmount",title:a("quotes.subtotal"),render:e=>{const{totalAmount:l,currency:d}=e,i=d;return le(Number(l),{currency:i,isConversionRate:!1,useCurrentCurrency:!!d})},style:{textAlign:"right"}},{key:"status",title:a("quotes.status"),render:e=>n.jsx(K,{code:e.status}),isSortable:!0}],[a])};function He(){const{getAvailableFilters:a,draftQuoteListLength:e,customer:l,getQuotesList:d}=Ce(),i=Be(),u={q:"",orderBy:"-".concat(D[Q]),createdBy:"",salesRep:"",status:"",dateCreatedBeginAt:"",dateCreatedEndAt:""},[r,o]=f.useState(u),[q,b]=f.useState(!1),[A,s]=f.useState([]),[c,C,g]=pe(D,Q,r,o),y=me(),x=k(),[R]=ae(),{state:{openAPPParams:p},dispatch:U}=f.useContext(re);f.useEffect(()=>{a().then(t=>s(t)),p.quoteBtn&&U({type:"common",payload:{openAPPParams:{quoteBtn:"",shoppingListBtn:""}}})},[]);const T=(t,m)=>{Number(m)===0?y("/quoteDraft"):y("/quoteDetail/".concat(t.id,"?date=").concat(t.createdAt))},M=f.useCallback(async t=>{const{edges:m=[],totalCount:V}=await d(t);if(t.offset===0&&e){const B=ge(),P={node:{quoteNumber:"—",quoteTitle:"—",createdAt:"—",salesRepEmail:"—",createdBy:"".concat(l.firstName," ").concat(l.lastName),updatedAt:"—",expiredAt:"—",totalAmount:B==null?void 0:B.grandTotal,status:0,taxTotal:B==null?void 0:B.tax}},{status:G,createdBy:j,salesRep:W,dateCreatedBeginAt:_,dateCreatedEndAt:H}=r,w=!G&&!W&&!_&&!H;if(j&&w){const S=/^[^(]+/.exec(j);(S!=null&&S.length?S[0].trim():"")===P.node.createdBy&&m.unshift(P)}else w&&m.unshift(P)}return{edges:m,totalCount:V}},[d,e,l.firstName,l.lastName,r]),O=(t,m)=>{t==="search"&&o({...r,q:m})},z=t=>{const m={createdBy:(t==null?void 0:t.createdBy)||"",status:(t==null?void 0:t.status)||"",salesRep:(t==null?void 0:t.salesRep)||"",dateCreatedBeginAt:(t==null?void 0:t.startValue)||"",dateCreatedEndAt:(t==null?void 0:t.endValue)||""};o({...r,...m})};return n.jsx(oe,{isSpinning:q,children:n.jsxs(L,{sx:{display:"flex",flexDirection:"column",flex:1},children:[n.jsx(v,{filterMoreInfo:A,startPicker:{isEnabled:!0,label:x("quotes.from"),defaultValue:(r==null?void 0:r.dateCreatedBeginAt)||"",pickerKey:"start"},endPicker:{isEnabled:!0,label:x("quotes.to"),defaultValue:(r==null?void 0:r.dateCreatedEndAt)||"",pickerKey:"end"},handleChange:O,handleFilterChange:z}),n.jsx(ne,{columnItems:i,rowsPerPageOptions:[10,20,30],getRequestList:M,searchParams:r,isCustomRender:!1,requestLoading:b,tableKey:"quoteNumber",sortDirection:C,orderBy:g,sortByFn:c,labelRowsPerPage:x(R?"quotes.cardsPerPage":"quotes.quotesPerPage"),renderItem:t=>n.jsx(fe,{item:t,goToDetail:T}),onClickRow:t=>{T(t,Number(t.status))},hover:!0})]})})}export{He as default};
//# sourceMappingURL=index-j3XFE94I.js.map

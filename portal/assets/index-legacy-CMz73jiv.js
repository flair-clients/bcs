System.register(["./mui-legacy-nJi-LPwx.js","./reactVendor-legacy-CtYIj4Ma.js","./form-legacy-CAo5v63e.js","./lang-legacy-BZ1lZp4I.js","./lodashEs-legacy-CZW16S6G.js","./B3Card-legacy-Bytz0U5Z.js","./B3CustomForm-legacy-DPyFojA8.js","./react-setup-legacy-DjnQrG6U.js","./load-functions-legacy-Bi-Vku98.js","./base-legacy-BAe6cWtL.js","./b3Login-legacy-CPRTqhNs.js","./config-legacy-F3NV_K8L.js","./RegisteredFinish-legacy-DeCMaq3a.js","./router-legacy-s4T0V6vG.js","./intl-legacy-B7uNycgM.js","./eCache-legacy-CW-H9Ud9.js","./muiIcon-legacy-CbXEHT38.js","./redux-legacy-D5ZHjMNV.js","./toolkit-legacy-uWyLsHZ1.js","../index-legacy.BFKCpyw1.js","./global-legacy-B1EgakWG.js","./dateFns-legacy-Bs-ooDPO.js","./dropzone-legacy-C0uLCPXC.js","./validatorRules-legacy-CTb2-K1i.js"],(function(e,t){"use strict";var a,s,n,r,l,o,i,c,d,u,m,f,g,p,h,b,y,x,j,F,w,C,T,S,E,I,N,B,L,k,V,A,M,v,R,q,z,O,P,D,_,G;return{setters:[e=>{a=e.x,s=e.j,n=e.B,r=e.a6,l=e.a1},e=>{o=e.r},e=>{i=e.u},e=>{c=e.u},e=>{d=e.i},e=>{u=e.B},e=>{m=e.B},e=>{f=e.a,g=e.G,p=e.u,h=e.bL,b=e.C,y=e.k,x=e.ad,j=e.ae,F=e.af,w=e.am,C=e.K,T=e.bG,S=e.ah,E=e.bN,I=e.aI},null,e=>{N=e.b},e=>{B=e.l},e=>{L=e.c,k=e.g,V=e.d,A=e.h,M=e.a,v=e.B,R=e.t},e=>{q=e.a,z=e.b,O=e.R,P=e.c,D=e.T,_=e.I},e=>{G=e.u},null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",(function(e){const[a,U]=o.useState(""),[W,$]=o.useState(!1),{setOpenPage:H}=e,K=c(),[Y]=f(),{control:J,handleSubmit:Q,getValues:X,formState:{errors:Z},setValue:ee,setError:te,watch:ae}=i({mode:"onSubmit"}),{state:{storeName:se,logo:ne,blockPendingAccountOrderCreation:re,registerEnabled:le}}=o.useContext(g),oe=G(),ie=p((({company:e})=>e.customer)),{id:ce,firstName:de,lastName:ue,emailAddress:me,phoneNumber:fe}=ie,{state:ge,dispatch:pe}=o.useContext(h),{state:{companyAutoApproval:he,portalStyle:{backgroundColor:be="#FEF9F5"}}}=o.useContext(b),ye=y(be),xe=(e=!1)=>{pe({type:"loading",payload:{isLoading:e}})};o.useEffect((()=>{xe(!1),le||oe("/login")}),[le]),o.useEffect((()=>{(async()=>{try{pe&&(xe(!0),pe({type:"finishInfo",payload:{submitSuccess:!1}}));const e=await F(3),t=(e?.accountFormFields||[]).map((e=>{const t=e;return L.includes(e?.fieldId||"")&&4===e.groupId&&(t.isRequired=!0,t.visible=!0),e})),a=k(t||[]),{countries:s}=await w(),n=a.address.map((e=>{const t=e;return"country"===e.name&&(t.options=s,t.replaceOptions={label:"countryName",value:"countryName"}),e})),r={phone:fe,first_name:de,last_name:ue,email:me},l=a.contactInformation.map((e=>{const t=e;return t.disabled=!0,t.default=r[V(e.name)]||e.default,e.required&&!e?.default&&(t.disabled=!1),e}));pe&&pe({type:"all",payload:{isLoading:!1,storeName:se,bcTob2bContactInformation:[...l],bcTob2bCompanyExtraFields:[],bcTob2bCompanyInformation:[...a.businessDetails],bcTob2bAddressBasicFields:[...n],countryList:[...s]}})}catch(e){N.error(e)}})()}),[]);const{bcTob2bContactInformation:je,isLoading:Fe,bcTob2bCompanyInformation:we=[],bcTob2bAddressBasicFields:Ce=[],countryList:Te=[],bcTob2bCompanyExtraFields:Se=[]}=ge;o.useEffect((()=>{const e=(e,t="")=>{const a=Te.find((t=>t.countryCode===e||t.countryName===e))?.states||[],s=Ce.find((e=>"state"===e.name));s&&(a.length>0?(s.fieldType="dropdown",s.options=a,s.required=!0):(s.fieldType="text",s.options=[],s.required=!1)),ee("state",t&&e&&(a.find((e=>e.stateCode===t))||0===a.length)?t:""),pe({type:"stateList",payload:{stateList:a,bcTob2bAddressBasicFields:[...Ce]}})};(()=>{const t=X("country"),a=X("state");e(t,a)})();const t=ae(((t,{name:a,type:s})=>{const{country:n,state:r}=t;"country"===a&&"change"===s&&e(n,r)}));return()=>t.unsubscribe()}),[Te]);const Ee=async e=>{try{const t=await M({extraFields:e});if(200!==t.code){const e=t.data?.errMsg||t.message||"",a=e.split(":");if(a.length>=2){const e=je?.find((e=>e.custom&&v.decode(e.name)===a[0]));if(e)return te(e.name,{type:"manual",message:a[1]}),(e=>{if(je){const t=je.map((t=>t.name===e?{...t,disabled:!1}:t));pe&&pe({type:"all",payload:{bcTob2bContactInformation:[...t]}})}})(e.name),xe(!1),!1}return U(e),xe(!1),!1}return U(""),!0}catch(t){return!1}};return s.jsx(u,{setOpenPage:H,children:s.jsx(q,{isMobile:Y,children:s.jsx(x,{isSpinning:Fe,tip:K("global.tips.loading"),transparency:"0",children:s.jsxs(n,{sx:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center","& h4":{color:ye},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiDropzoneArea-textContainer, & .MuiSelect-select.MuiSelect-filled, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:[ne&&s.jsx(z,{children:s.jsx(r,{sx:{maxWidth:"250px"},onClick:()=>{window.location.href="/"},children:s.jsx("img",{src:ne,alt:K("global.tips.registerLogo"),loading:"lazy"})})}),W?s.jsx(O,{handleFinish:()=>{B(oe,!0)&&(he.enabled?oe("/orders"):window.location.href="/")},isBCToB2B:!0}):s.jsxs(t,{sx:{width:Y?"100%":"537px",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px",marginTop:"1rem",background:"#FFFFFF",padding:"0 0.8rem 1rem 0.8rem"},children:[s.jsx(P,{children:K("registeredbctob2b.title")}),a&&s.jsx(l,{severity:"error",children:s.jsx(D,{children:a})}),s.jsxs(n,{sx:{width:"100%"},children:[s.jsx(_,{children:je?.length?je[0]?.groupName:""}),s.jsx(m,{formFields:je||[],errors:Z,control:J,getValues:X,setValue:ee})]}),s.jsxs(n,{sx:{width:"100%"},children:[s.jsx(_,{children:we?.length?we[0]?.groupName:""}),s.jsx(m,{formFields:[...we,...Se],errors:Z,control:J,getValues:X,setValue:ee,setError:te})]}),s.jsxs(n,{sx:{width:"100%"},children:[s.jsx(_,{children:Ce?.length?Ce[0]?.groupName:""}),s.jsx(m,{formFields:Ce,errors:Z,control:J,getValues:X,setValue:ee})]}),!W&&s.jsx(n,{sx:{display:"flex",flexDirection:"row-reverse",pt:2,width:"100%"},children:s.jsx(j,{variant:"contained",onClick:e=>{const t=(()=>{const e=X(),t=we.find((e=>"field_attachments"===e.fieldId));return!(d(t)||!t.required||0!==e[t.name].length||(te(t.name,{type:"required",message:K("global.validate.required",{label:t.label??""})}),xe(!1),0))})();Q((async e=>{if(!t){xe(!0);try{const t=await(async e=>{try{const t=we.filter((e=>!!e.custom)),a=t.map((t=>({fieldName:V(t.name),fieldValue:e[t.name]||t.default}))),s=await A({extraFields:a});if(200!==s.code){const e=s.data?.errMsg||s.message||"",a=e.split(":");if(a.length>=2){const e=t.find((e=>V(e.name)===a[0]));if(e)return te(e.name,{type:"manual",message:a[1]}),xe(!1),!1}throw e}return U(""),!0}catch(t){throw N.error(t),t}})(e);if(!t)return;const a=(je||[]).filter((e=>!!e.custom)),s=[];a.length&&a.forEach((t=>{const a={};a.fieldName=V(t.name),a.fieldValue=e[t.name]||t?.default||"",s.push(a)}));let n=!0;if(s.length>0&&(n=await Ee(s)),!n)return;const r=we.filter((e=>"files"===e.fieldType)),l=await(async(e,t)=>{let a=[];if(e.length){e.forEach((e=>{a=t[e.name]||[]}));try{return(await Promise.all(a.map((e=>T({file:e,type:"companyAttachedFile"}))))).reduce(((e,t)=>{let a=e;if(200!==t.code)throw t.data.errMsg||t.message||K("intl.global.fileUpload.fileUploadFailure");{const s={...t.data};s.fileSize=s.fileSize?`${s.fileSize}`:"",a=[...e,s]}return a}),[])}catch(s){throw N.error(s),s}}})(r||[],e);await(async(e,t,a,s)=>{const n={};n.customerId=t||"",n.storeHash=I,n.userExtraFields=s;const r=we.filter((e=>!e.custom&&"files"!==e.fieldType)),l=we.filter((e=>!!e.custom));if(r.length&&r.forEach((t=>{n[R(V(t.name))]=e[t.name]||""})),l.length){const t=[];l.forEach((a=>{const s={};s.fieldName=V(a.name),s.fieldValue=e[a.name]||"",t.push(s)})),n.extraFields=t}const o=Ce.filter((e=>!e.custom)),i=Ce.filter((e=>!!e.custom));if(o.length&&o.forEach((t=>{const a=V(t.name);"address1"===a&&(n.addressLine1=e[t.name]||""),"address2"===a&&(n.addressLine2=e[t.name]||""),n[a]=e[t.name]||""})),i.length){const t=[];i.forEach((a=>{const s={};s.fieldName=V(a.name),s.fieldValue=e[a.name]||"",t.push(s)})),n.addressExtraFields=t}return n.fileList=a,n.channelId=S,E(n)})(e,ce,l,s);const o=he.enabled;me&&(pe({type:"finishInfo",payload:{submitSuccess:!0,isAutoApproval:o,blockPendingAccountOrderCreation:re}}),pe({type:"all",payload:{accountType:"1"}}),await C(),$(!0))}catch(a){N.error(a),U(a?.message||a)}finally{xe(!1)}}}))(e)},children:K("global.button.submit")})})]})]})})})})}));const t=e("StyledRegisterContent",a(n)({"& #b3-customForm-id-name":{'& label[data-shrink="true"]':{whiteSpace:"break-spaces",minWidth:"calc(133% - 24px)",transition:"unset"},'& label[data-shrink="false"]':{whiteSpace:"break-spaces"}}}))}}}));
//# sourceMappingURL=index-legacy-CMz73jiv.js.map

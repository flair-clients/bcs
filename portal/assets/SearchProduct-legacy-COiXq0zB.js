System.register(["./mui-legacy-nJi-LPwx.js","./react-setup-legacy-DjnQrG6U.js","./reactVendor-legacy-CtYIj4Ma.js","./lang-legacy-BZ1lZp4I.js","./B3FilterSearch-legacy-ChgjgfIK.js","./load-functions-legacy-Bi-Vku98.js","./base-legacy-BAe6cWtL.js","./useBlockPendingAccountViewPrice-legacy-C0WGTZHY.js","./form-legacy-CAo5v63e.js","./lodashEs-legacy-CZW16S6G.js","./B3CustomForm-legacy-DPyFojA8.js"],(function(t,e){"use strict";var n,i,a,s,o,r,c,l,d,u,p,h,g,x,f,y,m,b,v,j,S,L,C,k,_,O,I,w,P,B,T,E,A,q,D,V;return{setters:[t=>{n=t.o,i=t.j,a=t.B,s=t.x,o=t.T,r=t.ah,c=t.f,l=t.ag},t=>{d=t.r,u=t.u,p=t.bm,h=t.c1,g=t.bI,x=t.ag,f=t.c2,y=t.ab,m=t.ad,b=t.aO,v=t.ax,j=t.a$,S=t.b0,L=t.bo,C=t.b5,k=t.bh,_=t.a,O=t.aW,I=t.ae,w=t.b1},t=>{P=t.r},t=>{B=t.u},t=>{T=t.d},null,t=>{E=t.b},t=>{A=t.u},t=>{q=t.u},t=>{D=t.b},t=>{V=t.B}],execute:function(){t({C:M,S:function({updateList:t=(()=>{}),addToList:e,searchDialogTitle:n,addButtonText:s,isB2BUser:r,type:d}){const p=B(),h=u((({company:t})=>t.companyInfo.id)),g=u((t=>t.company.customer.customerGroupId)),f=u((({company:t})=>t.companyInfo.status)),y=u((({b2bFeatures:t})=>t.masqueradeCompany.id)),b=h||y,[v,L]=P.useState(!1),[k,_]=P.useState(!1),[O,E]=P.useState(!1),[q,D]=P.useState(""),[V,W]=P.useState([]),[z,F]=P.useState(!1),[N,U]=P.useState(),[$]=A(),G=t=>{D(t.target.value)},H=async()=>{if(!q||v)return;if($&&0===f)return void x.info(p("global.searchProductAddProduct.businessAccountPendingApproval"));const t=r?j:S;L(!0);try{const{productsSearch:e}=await t({search:q,companyId:b,customerGroupId:g,categoryFilter:!0}),n=w(e);W(n),_(!0)}finally{L(!1)}},Q=()=>{H()},R=async n=>{try{L(!0),await C(n),await e(n),t()}finally{L(!1)}};return i.jsxs(a,{sx:{margin:"24px 0"},children:[i.jsx(o,{children:p("global.searchProductAddProduct.searchBySkuOrName")}),i.jsx(c,{hiddenLabel:!0,placeholder:p(`global.searchProduct.placeholder.${d}`),variant:"filled",fullWidth:!0,size:"small",value:q,onChange:G,onKeyDown:t=>{"Enter"===t.key&&H()},InputProps:{startAdornment:i.jsx(l,{position:"start",children:i.jsx(T,{})})},sx:{margin:"12px 0","& input":{padding:"12px 12px 12px 0"}}}),i.jsx(I,{variant:"outlined",fullWidth:!0,disabled:v,onClick:Q,children:i.jsx(m,{isSpinning:v,tip:"",size:16,children:i.jsx(a,{sx:{flex:1,textAlign:"center"},children:p("global.searchProductAddProduct.searchProduct")})})}),i.jsx(J,{isOpen:k,isLoading:v,productList:V,searchText:q,type:d,onSearchTextChange:G,onSearch:Q,onCancel:()=>{F(!1),_(!1),O&&(E(!1),t()),W([])},onProductQuantityChange:(t,e)=>{const n=V.find((e=>e.id===t));n&&(n.quantity=e),W([...V])},onChooseOptionsClick:t=>{const e=V.find((e=>e.id===t));e&&U({...e}),_(!1),F(!0)},onAddToListClick:async t=>{await R(t)},searchDialogTitle:n,addButtonText:s}),i.jsx(M,{isOpen:z,isLoading:v,type:d,setIsLoading:L,product:N,onCancel:()=>{F(!1),_(!0)},onConfirm:async t=>{try{L(!0),await C(t),await R(t),F(!1),_(!0)}catch(e){L(!1)}finally{L(!1)}},addButtonText:s,isB2BUser:r})]})},b:function(t){const[e,n]=P.useReducer(K,Q),{children:a}=t,s=P.useMemo((()=>({state:e,dispatch:n})),[e]);return i.jsx(R.Provider,{value:s,children:a})}});var e={},W=n;Object.defineProperty(e,"__esModule",{value:!0}),t("d",e.default=void 0);var z=W(d()),F=i;t("d",e.default=(0,z.default)((0,F.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"));const N=s("div")({display:"flex",wordBreak:"break-word",gap:"8px",flexWrap:"wrap",padding:"12px 0 12px","&:first-of-type":{marginTop:"12px"}}),U=s("div")((({padding:t})=>({display:"flex",flexGrow:1,flexShrink:1,alignItems:"flex-start",width:"100%",padding:t||"0 0 0 16px"}))),$=s("img")((()=>({width:"60px",height:"60px",borderRadius:"4px",marginTop:"12px",flexShrink:0}))),G=s("div")((()=>({fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"}))),H=s(c)((()=>({"& input::-webkit-outer-spin-button, input::-webkit-inner-spin-button":{marginTop:"-8px",marginBottom:"8px"}})));function M(t){const{isOpen:e,onCancel:n,onConfirm:s,product:c,isEdit:l=!1,isLoading:d,setIsLoading:_,isB2BUser:O,type:I,...w}=t,T=B(),{addButtonText:A=T("shoppingList.chooseOptionsDialog.addToList")}=w,W=u((({global:t})=>t.showInclusiveTaxPrice)),z=u((({global:t})=>t.blockPendingQuoteNonPurchasableOOS.isEnableProduct)),F=u((({b2bFeatures:t})=>t.masqueradeCompany.id)),M=u((t=>t.company.customer.customerGroupId)),Q=u((t=>t.company.companyInfo.id)),[R,K]=P.useState(1),[X,Y]=P.useState([]),[J,Z]=P.useState(null),[tt,et]=P.useState(""),[nt,it]=P.useState(c?.imageUrl||""),[at,st]=P.useState(!0),[ot,rt]=P.useState({}),[ct,lt]=P.useState([]),[dt,ut]=P.useState(0),[pt,ht]=P.useState([]),[gt,xt]=P.useState(!1);P.useEffect((()=>{if("quote"===I&&c)if(tt){const t=c;t.quantity=R;const e=!!p(t.base_price,t,{sku:tt});st(e)}else{const t=c;t.quantity=R,h(t.base_price,t)||st(!1)}else"shoppingList"!==I&&"quickOrder"!==I||!c||st(!c?.isPriceHidden)}),[tt,R,c,I]),P.useEffect((()=>{c?((async t=>{try{_(!0);const e=t?.modifiers?.filter((t=>"product_list_with_images"===t.type||"product_list"===t.type))||[],n={},i={};if(e.length>0){const t=e.reduce(((t,e)=>{const{option_values:n}=e;return n.forEach((e=>{e?.value_data?.product_id&&t.push(e.value_data.product_id)})),t}),[]);if(t.length>0){const e=O?j:S,a=Q||F,{productsSearch:s}=await e({productIds:t,companyId:a,customerGroupId:M});s.forEach((t=>{n[t.id]=t.imageUrl,i[t.id]=t}))}}rt(i),K(t.quantity),1===t.variants?.length&&t.variants[0]&&Z(t.variants[0]);const a=L(t,n);Y([...a])}finally{_(!1)}})(c),ht([]),ut(0),c?.allOptions?.length&&(t=>{const e=[];t.allOptions?.forEach((t=>{"product_list_with_images"!==t.type&&"product_list"!==t.type&&"checkbox"!==t.type&&"rectangles"!==t.type&&"swatch"!==t.type&&"radio_buttons"!==t.type&&"dropdown"!==t.type||e.push(t)})),lt(e)})(c)):(K(1),Y([]))}),[c]);const{control:ft,handleSubmit:yt,getValues:mt,formState:{errors:bt},watch:vt,setValue:jt,reset:St}=q({mode:"all"}),Lt=vt(),Ct=P.useRef(Lt),kt=P.useCallback((async(t,e="")=>{if(!X.find((t=>t.name===e))?.isVariantOption||!c||!e)return;const{variants:n=[]}=c||{},i=n.find((e=>{const{option_values:n=[]}=e;return n.reduce(((e,n)=>t[g.encode(`attribute[${n.option_id}]`)].toString()===(n.id||"").toString()&&e),!0)}))||null;if(et(i?i.sku:""),Z(i),i&&(i.sku||i.variant_id)){const t=n.find((t=>t.sku===i.sku||t.variant_id===i.variant_id));it(t?.image_url||c.imageUrl||"")}}),[X,c]);P.useEffect((()=>{const t=vt(((t,{name:e})=>{kt(t,e)}));if(X[0]){const t=X.reduce(((t,e)=>(t[e.name]=e.default,jt(e.name,e.default),t)),{});kt(t,X[0].name)}return()=>t.unsubscribe()}),[X,kt]);const _t=P.useCallback((()=>{const{purchasing_disabled:t=!0}=J||{};return!("shoppingList"!==I&&!0===t&&!z&&(x.error(T("shoppingList.chooseOptionsDialog.productNoLongerForSale")),1))}),[z,I,J]),Ot=P.useCallback((t=>{const e=f(X,{},t);return Object.keys(e).map((t=>({optionId:t,optionValue:e[t]?.toString()})))}),[X]);return P.useEffect((()=>{if((!Ct?.current||!D(Ct?.current,Lt))&&(Ct.current=Lt,Object.keys(Lt).length&&X.length&&ct.length)){const t=Ot(Lt),{variant_id:e=""}=J||{};if(!(c&&c.id&&e&&_t()))return;const n=[{...c,newSelectOptionList:t,productId:c?.id,quantity:parseInt(R.toString(),10)||1,variantId:parseInt(e.toString(),10)||1,additionalProducts:ot}];if(pt[0]){let e=!1;const{newSelectOptionList:i}=pt[0];i.forEach((n=>{const i=ct.findIndex((t=>n.optionId.includes(String(t.id))));t.forEach((t=>{n.optionId===t.optionId&&n.optionValue!==t.optionValue&&-1!==i&&(e=!0)}))})),e&&ht(n)}else ht(n)}}),[ot,pt,X.length,Lt,Ot,c,ct,R,_t,J]),P.useEffect((()=>{(async()=>{try{if(pt.length){xt(!0);const t=await C(pt);if(t[0]){const{basePrice:e,taxPrice:n}=t[0],i=k(Number(e),Number(n));ut(i)}}}catch(t){E.error(t)}finally{xt(!1)}})()}),[pt]),P.useEffect((()=>{e||St()}),[e]),i.jsx(y,{isOpen:e,rightSizeBtn:l?T("shoppingList.chooseOptionsDialog.saveOption"):A,handleLeftClick:()=>{K(1),n()},handRightClick:()=>{yt((t=>{const e=Ot(t),{variant_id:n=""}=J||{};c&&c.id&&n&&_t()&&s([{...c,newSelectOptionList:e,productId:c?.id,quantity:parseInt(R.toString(),10)||1,variantId:parseInt(n.toString(),10)||1,additionalProducts:ot}])}))()},title:T("shoppingList.chooseOptionsDialog.chooseOptions"),loading:d||gt,children:i.jsx(m,{isSpinning:d,children:c&&i.jsx(a,{children:i.jsxs(a,{sx:{display:"flex",flexDirection:"column"},children:[i.jsxs(a,{sx:{display:"flex"},children:[i.jsx($,{src:nt||c.imageUrl||b}),i.jsxs(N,{children:[i.jsx(U,{padding:"0",children:i.jsxs(a,{sx:{marginLeft:"16px"},children:[i.jsx(o,{variant:"body1",color:"#212121",children:c.name}),i.jsx(o,{variant:"body1",color:"#616161",children:tt||c.sku}),(c.product_options||[]).map((t=>i.jsx(G,{children:`${t.display_name}: ${t.display_value}`},`${t.option_id}`)))]})}),i.jsxs(U,{children:[i.jsx("span",{children:T("shoppingList.chooseOptionsDialog.price")}),at?v(dt*Number(R)||(t=>{const{variants:e=[]}=t;let n=0;if(tt){const t=e.find((t=>t.sku===tt))?.bc_calculated_price;n=(W?t?.tax_inclusive:t?.tax_exclusive)||0}else{const t=e[0]?.bc_calculated_price;n=parseFloat((W?t?.tax_inclusive:t?.tax_exclusive)?.toString())||0}return n})(c)):""]}),i.jsx(U,{children:i.jsx(H,{type:"number",variant:"filled",label:T("shoppingList.chooseOptionsDialog.quantity"),value:R,onChange:t=>{(!t.target.value||parseInt(t.target.value,10)>0)&&K(t.target.value)},onKeyDown:t=>{["KeyE","Equal","Minus"].indexOf(t.code)>-1&&t.preventDefault()},onBlur:()=>{R||K(1),Number(R)>1e6&&K(1e6)},size:"small",sx:{width:"60%",maxWidth:"100px"}})})]})]}),i.jsx(r,{sx:{margin:"16px 0 24px"}}),i.jsx(V,{formFields:X,errors:bt,control:ft,getValues:mt,setValue:jt})]})})})})}const Q={id:0,isLoading:!1},R=t("a",P.createContext({state:Q,dispatch:()=>{}})),K=(t,e)=>{switch(e.type){case"all":return{...t,...e.payload};case"init":return{...t,id:e.payload.id};case"loading":return{...t,isLoading:e.payload.isLoading};default:return t}};function X(t){const{product:{id:e,allOptions:n},onAddToListClick:a,onChooseOptionsClick:s,addButtonText:o}=t,{state:{isLoading:r=!1}}=P.useContext(R),[c]=_(),l=B();return n&&n.length>0?i.jsx(I,{variant:"outlined",onClick:()=>{s(e)},disabled:r,fullWidth:c,children:l("global.searchProduct.chooseOptionsButton")}):i.jsx(I,{variant:"outlined",onClick:()=>{a(e)},disabled:r,fullWidth:c,children:o})}const Y=O;function J(t){const e=B(),{isOpen:n,onCancel:s,searchText:r,productList:d,onSearchTextChange:p,onSearch:h,onProductQuantityChange:g,onAddToListClick:f,onChooseOptionsClick:b,isLoading:v,type:j,searchDialogTitle:S=e("shoppingLists.title"),addButtonText:L=e("shoppingLists.addButtonText")}=t,C=u((({global:t})=>t.blockPendingQuoteNonPurchasableOOS.isEnableProduct)),[k]=_(),O=P.useCallback((t=>{const{variants:n=[]}=t||{},{purchasing_disabled:i=!0}=n[0]||{};return!("shoppingList"!==j&&!0===i&&!C&&(x.error(e("shoppingList.chooseOptionsDialog.productNoLongerForSale")),1))}),[C,j]),I=t=>{const e=d.find((e=>e.id===t));if(e&&O(e||{})){let t=e.variantId||0;!e.variantId&&e.variants?.[0]&&(t=e.variants[0].variant_id),f([{...e,newSelectOptionList:[],quantity:parseInt(e.quantity.toString(),10)||1,variantId:t}])}};return i.jsx(y,{fullWidth:!0,isOpen:n,handleLeftClick:()=>{s()},title:S,showRightBtn:!1,loading:v,maxWidth:"md",leftSizeBtn:e("shoppingLists.close"),children:i.jsx(m,{isSpinning:v,children:i.jsxs(a,{sx:{minWidth:k?"initial":"100%",flex:1},children:[i.jsx(c,{hiddenLabel:!0,variant:"filled",fullWidth:!0,size:"small",value:r,onChange:p,onKeyDown:t=>{"Enter"===t.key&&h()},error:!d||d.length<=0,InputProps:{startAdornment:i.jsx(l,{position:"start",children:i.jsx(T,{})})},sx:{margin:"12px 0","& input":{padding:"12px 12px 12px 0"}}}),d&&d.length>0?i.jsx(Y,{products:d,quantityEditable:!0,type:j,textAlign:k?"left":"right",canToProduct:!0,onProductQuantityChange:g,renderAction:t=>i.jsx(X,{product:t,onAddToListClick:I,onChooseOptionsClick:b,addButtonText:L}),actionWidth:"180px"}):i.jsx(o,{children:"No products found"})]})})})}}}}));
//# sourceMappingURL=SearchProduct-legacy-COiXq0zB.js.map
